(()=>{"use strict";var e={129:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.checkAuth=void 0,o.checkAuth=function(){return!0}},685:function(e,o,t){var r=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))((function(i,n){function s(e){try{d(r.next(e))}catch(e){n(e)}}function l(e){try{d(r.throw(e))}catch(e){n(e)}}function d(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,l)}d((r=r.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.carritoManage=void 0;const i=t(147);o.carritoManage=class{constructor(e){this.ruta=e}getCarritos(){return r(this,void 0,void 0,(function*(){try{let e=yield i.promises.readFile(this.ruta,"utf-8");return JSON.parse(e)}catch(e){console.log(""+e)}}))}carritoById(e){return r(this,void 0,void 0,(function*(){try{return(yield this.getCarritos()).find((o=>o.id==e)).productos}catch(e){console.log(""+e)}}))}createCarrito(e){return r(this,void 0,void 0,(function*(){try{let o=yield this.getCarritos(),t=1;o.length>0&&(t=o[o.length-1].id+1);let r=Object.assign(Object.assign({},e),{id:t});o.push(r),i.writeFile(this.ruta,JSON.stringify(o,null,2),(e=>{e?console.log("error en la escritura"+e):console.log("seguardo correctamente")}))}catch(e){console.log("error al guardar"+e)}}))}deleteCarritoById(e){return r(this,void 0,void 0,(function*(){try{let o=(yield this.getCarritos()).filter((o=>o.id!=e));i.writeFile(this.ruta,JSON.stringify(o,null,2),(e=>{e?console.log("error al eliminar"+e):console.log("se elimino correctamente")}))}catch(e){console.log("error al eliminar"+e)}}))}maxId(e){let o=0;for(let t=0;t<e.length;t++)e[t].id>o&&(o=e[t].id);return o}pushProduct(e,o){return r(this,void 0,void 0,(function*(){try{console.log(e);let t=(yield this.getCarritos()).find((o=>o.id==e));console.log(t);let r=this.maxId(t.productos);console.log(r);let n=Object.assign(Object.assign({},o),{id:r+1});t.productos.push(n),yield this.deleteCarritoById(e);let s=yield this.getCarritos();s.push(t),i.writeFile(this.ruta,JSON.stringify(s,null,2),(e=>{e?console.log("error al agregar"+e):console.log("se agrego correctamente")}))}catch(e){console.log(""+e)}}))}deleteProductById(e,o){return r(this,void 0,void 0,(function*(){try{let t=(yield this.getCarritos()).find((o=>o.id==e)),r=t.productos.filter((e=>e.id!=o));yield this.deleteCarritoById(e);let n=yield this.getCarritos();console.log(n),t.productos=r,console.log(t.prodcutos),n.push(t),console.log(n),i.writeFile(this.ruta,JSON.stringify(n,null,2),(e=>{e?console.log("error al agregar"+e):console.log("se agrego correctamente")}))}catch(e){console.log(""+e)}}))}}},571:function(e,o,t){var r=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))((function(i,n){function s(e){try{d(r.next(e))}catch(e){n(e)}}function l(e){try{d(r.throw(e))}catch(e){n(e)}}function d(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,l)}d((r=r.apply(e,o||[])).next())}))};Object.defineProperty(o,"__esModule",{value:!0}),o.productManage=void 0;const i=t(147);o.productManage=class{constructor(e){this.ruta=e}getAll(){return r(this,void 0,void 0,(function*(){try{let e=yield i.promises.readFile(this.ruta,"utf-8");return JSON.parse(e)}catch(e){console.log("error en la lectura"+e)}}))}save(e){return r(this,void 0,void 0,(function*(){try{let o=yield this.getAll(),t=1;o.length>0&&(t=o[o.length-1].id+1);let r=Object.assign(Object.assign({},e),{id:t});o.push(r),i.writeFile(this.ruta,JSON.stringify(o,null,2),(e=>{e?console.log("error en la escritura"+e):console.log("seguardo correctamente")}))}catch(e){console.log("error al guardar"+e)}}))}deleteById(e){return r(this,void 0,void 0,(function*(){try{let o=(yield this.getAll()).filter((o=>o.id!=e));i.writeFile(this.ruta,JSON.stringify(o,null,2),(e=>{e?console.log("error al eliminar"+e):console.log("se elimino correctamente")}))}catch(e){console.log("error al eliminar"+e)}}))}update(e,o){return r(this,void 0,void 0,(function*(){try{if(void 0!==(yield this.getAll()).find((e=>e.id==o))){yield this.deleteById(o);let t=yield this.getAll(),r=Object.assign(Object.assign({},e),{id:o});t.push(r),i.writeFile(this.ruta,JSON.stringify(t,null,2),(e=>{e?console.log("error en la escritura"+e):console.log("seguardo correctamente")}))}}catch(e){console.log("error al actualizar"+e)}}))}getById(e){return r(this,void 0,void 0,(function*(){try{return(yield this.getAll()).find((o=>o.id==e))}catch(e){console.log("error al eliminar"+e)}}))}}},728:function(e,o,t){var r=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))((function(i,n){function s(e){try{d(r.next(e))}catch(e){n(e)}}function l(e){try{d(r.throw(e))}catch(e){n(e)}}function d(e){var o;e.done?i(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,l)}d((r=r.apply(e,o||[])).next())}))};const i=t(860),{productManage:n}=t(571),{carritoManage:s}=t(685),{checkAuth:l}=t(129),{Router:d}=i,c=i();c.use(i.urlencoded({extended:!0}));const a=new d,u=new d,g=new d;a.use(i.json()),c.use("/api",a),a.use("/productos",u),a.use("/carrito",g),u.get("/:id?",((e,o)=>r(void 0,void 0,void 0,(function*(){let{id:t}=e.params,r=new n("./src/uploads/productos.json");if(void 0===t){let e=yield r.getAll();o.json(e)}else{let e=yield r.getById(t);void 0===e&&o.json("no existe el producto"),o.json(e)}})))),u.post("/",((e,o)=>r(void 0,void 0,void 0,(function*(){if(l()){let t=new n("./src/uploads/productos.json");yield t.save(e.body),o.json("producto guardado")}else o.json("no esta autorizado")})))),u.put("/:id",((e,o)=>r(void 0,void 0,void 0,(function*(){if(l()){let{id:t}=e.params,r=new n("./src/uploads/productos.json");void 0===(yield r.getById(t))?o.json("no existe el producto"):(yield r.update(e.body,t),o.json("actualizado"))}else o.json("no esta autorizado")})))),u.delete("/:id",((e,o)=>r(void 0,void 0,void 0,(function*(){if(l()){let{id:t}=e.params,r=new n("./src/uploads/productos.json");yield r.deleteById(t),o.json(yield r.getAll())}else o.json("no esta autorizado")})))),g.post("/",((e,o)=>r(void 0,void 0,void 0,(function*(){let t=new s("./src/uploads/carrito.json");yield t.createCarrito(e.body),o.json("seguardo")})))),g.delete("/:id",((e,o)=>r(void 0,void 0,void 0,(function*(){let t=new s("./src/uploads/carrito.json");o.json(yield t.deleteCarritoById(e.params.id))})))),g.get("/:id/productos",((e,o)=>r(void 0,void 0,void 0,(function*(){let t=new s("./src/uploads/carrito.json");o.json(yield t.carritoById(e.params.id))})))),g.post("/:id?/productos",((e,o)=>r(void 0,void 0,void 0,(function*(){let t=new s("./src/uploads/carrito.json");yield t.pushProduct(e.params.id,e.body),o.json("se agrego el producto")})))),g.delete("/:idCarr/productos/:idProd",((e,o)=>r(void 0,void 0,void 0,(function*(){let t=new s("./src/uploads/carrito.json");yield t.deleteProductById(e.params.idCarr,e.params.idProd),o.json("se elimino el producto")})))),c.listen(8080,(()=>{console.log("Server running on port 8080")})).on("error",(e=>console.log(e)))},860:e=>{e.exports=require("express")},147:e=>{e.exports=require("fs")}},o={};!function t(r){var i=o[r];if(void 0!==i)return i.exports;var n=o[r]={exports:{}};return e[r].call(n.exports,n,n.exports,t),n.exports}(728)})();