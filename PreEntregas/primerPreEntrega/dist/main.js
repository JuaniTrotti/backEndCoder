(()=>{"use strict";var e={129:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkAuth=void 0,t.checkAuth=function(){return!0}},22:function(e,t,o){var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function l(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,l)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.productManage=t.producto=void 0;const n=o(147);t.producto=class{constructor(e,t,o,i,n,r){this.nombre=e,this.descripcion=t,this.codigo=o,this.precio=i,this.url=n,this.stock=r,this.timestamp=Date.now()}},t.productManage=class{constructor(e){this.ruta=e}getAll(){return i(this,void 0,void 0,(function*(){try{let e=yield n.promises.readFile(this.ruta,"utf-8");return JSON.parse(e)}catch(e){console.log("error en la lectura"+e)}}))}save(e){return i(this,void 0,void 0,(function*(){try{let t=yield this.getAll(),o=1;t.length>0&&(o=t[t.length-1].id+1);let i=Object.assign(Object.assign({},e),{id:o});t.push(i),n.writeFile(this.ruta,JSON.stringify(t,null,2),(e=>{e?console.log("error en la escritura"+e):console.log("seguardo correctamente")}))}catch(e){console.log("error al guardar"+e)}}))}deleteById(e){return i(this,void 0,void 0,(function*(){try{let t=(yield this.getAll()).filter((t=>t.id!=e));n.writeFile(this.ruta,JSON.stringify(t,null,2),(e=>{e?console.log("error al eliminar"+e):console.log("se elimino correctamente")}))}catch(e){console.log("error al eliminar"+e)}}))}update(e,t){return i(this,void 0,void 0,(function*(){try{if(void 0!==(yield this.getAll()).find((e=>e.id==t))){yield this.deleteById(t);let o=yield this.getAll(),i=Object.assign(Object.assign({},e),{id:t});o.push(i),n.writeFile(this.ruta,JSON.stringify(o,null,2),(e=>{e?console.log("error en la escritura"+e):console.log("seguardo correctamente")}))}}catch(e){console.log("error al actualizar"+e)}}))}getById(e){return i(this,void 0,void 0,(function*(){try{return(yield this.getAll()).find((t=>t.id==e))}catch(e){console.log("error al eliminar"+e)}}))}}},728:function(e,t,o){var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function l(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,l)}c((i=i.apply(e,t||[])).next())}))};const n=o(860),{productManage:r,producto:s}=o(22),{checkAuth:l}=o(129),{Router:c}=n,d=n();d.use(n.urlencoded({extended:!0}));const u=new c,a=new c,h=new c;u.use(n.json()),d.use("/api",u),u.use("/productos",a),u.use("/carrito",h),a.get("/:id?",((e,t)=>i(void 0,void 0,void 0,(function*(){let{id:o}=e.params,i=new r("./src/uploads/productos.json");if(void 0===o){let e=yield i.getAll(),o=new s("lapi","buenisima","vb",200,"urldelafoto",3);t.json(e,o)}else{let e=yield i.getById(o);void 0===e&&t.json("no existe el producto"),t.json(e)}})))),a.post("/",((e,t)=>i(void 0,void 0,void 0,(function*(){if(l()){let t=new r("./src/uploads/productos.json"),o=new s(e.body);yield t.save(o)}else t.json("no esta autorizado")})))),a.put("/:id",((e,t)=>i(void 0,void 0,void 0,(function*(){if(l()){let{id:o}=e.params,i=new r("./src/uploads/productos.json");if(void 0===(yield i.getById(o)))t.json("no existe el producto");else{let t=new s(e.body);yield i.update(o,t)}}else t.json("no esta autorizado")})))),a.delete("/:id",((e,t)=>i(void 0,void 0,void 0,(function*(){if(l()){let{id:o}=e.params,i=new r("./src/uploads/productos.json");yield i.deleteById(o),t.json(yield i.getAll())}else t.json("no esta autorizado")})))),d.listen(8080,(()=>{console.log("Server running on port 8080")})).on("error",(e=>console.log(e)))},860:e=>{e.exports=require("express")},147:e=>{e.exports=require("fs")}},t={};!function o(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,o),r.exports}(728)})();